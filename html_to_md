import os
import html2text

def convert_html_to_md():
    h = html2text.HTML2Text()
    h.ignore_links = False
    h.ignore_images = True
    h.bypass_tables = False

    output_file = "temiz_kaynaklar.md"
    # Çıktı dosyasını listeden kesin olarak çıkarıyoruz
    files = [f for f in os.listdir('.') if f.endswith('.html') and f != "tum_kaynaklar_birlesik.html"]

    if not files:
        print("Dönüştürülecek HTML dosyası bulunamadı.")
        return

    print(f"{len(files)} dosya dönüştürülüyor...")

    with open(output_file, "w", encoding="utf-8") as outfile:
        for filename in files:
            print(f"Dönüştürülüyor: {filename}")
            try:
                with open(filename, "r", encoding="utf-8", errors="ignore") as infile:
                    html_content = infile.read()
                    markdown_content = h.handle(html_content)
                    
                    outfile.write(f"\n\n# KAYNAK: {filename}\n\n")
                    outfile.write(markdown_content)
                    outfile.write("\n\n---\n")
            except Exception as e:
                print(f"Hata oluştu ({filename}): {e}")

    print(f"Bitti! Tüm içerik '{output_file}' olarak kaydedildi.")

if __name__ == "__main__":
    convert_html_to_md()